<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fake Casehug Clone</title>
<style>
  body {
    background: #121212;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    user-select: none;
  }
  header {
    width: 100%;
    background: #222;
    padding: 10px 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
    align-items: center;
  }
  #balance {
    position: fixed;
    top: 10px;
    right: 20px;
    background: #222;
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 18px;
    user-select: text;
  }
  #depositInput {
    width: 100px;
    font-size: 16px;
    padding: 5px 8px;
    border-radius: 5px;
    border: none;
    outline: none;
  }
  button {
    background: #ff4500;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    color: white;
    font-size: 16px;
    transition: background 0.3s;
  }
  button:hover {
    background: #ff3300;
  }
  main {
    flex-grow: 1;
    display: flex;
    max-width: 1200px;
    margin-top: 20px;
    gap: 20px;
    width: 100%;
    padding: 0 20px;
  }
  #casesList {
    flex: 1;
    background: #222;
    border-radius: 12px;
    padding: 15px;
    max-width: 320px;
    overflow-y: auto;
  }
  #casesList h2 {
    text-align: center;
    margin-bottom: 10px;
  }
  .case-item {
    background: #333;
    margin: 8px 0;
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s;
  }
  .case-item.selected {
    background: #ff4500;
    color: #fff;
  }
  .case-item:hover:not(.selected) {
    background: #444;
  }
  #rouletteSection {
    flex: 2;
    background: #222;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #rouletteDisplay {
    width: 100%;
    height: 120px;
    background: #111;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    border: 2px solid #444;
    margin-bottom: 15px;
  }
  #rouletteInner {
    display: flex;
    height: 100%;
    transition: transform 0.1s linear;
    will-change: transform;
  }
  .skin-card {
    width: 150px;
    margin: 0 10px;
    background: #333;
    border-radius: 10px;
    padding: 10px;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  .skin-card img {
    width: 120px;
    height: 60px;
    object-fit: contain;
    border-radius: 6px;
    margin-bottom: 5px;
    filter: drop-shadow(0 0 5px #000);
  }
  #rouletteButtons {
    margin-top: 10px;
    display: flex;
    gap: 15px;
  }
  #resultSection {
    margin-top: 15px;
    background: #111;
    border-radius: 10px;
    padding: 12px 20px;
    width: 100%;
    text-align: center;
    min-height: 130px;
    user-select: none;
  }
  #resultSkinName {
    font-size: 22px;
    margin-bottom: 10px;
    font-weight: 700;
  }
  #resultSkinImg {
    width: 180px;
    height: 90px;
    object-fit: contain;
    border-radius: 10px;
    filter: drop-shadow(0 0 10px #ff4500);
  }
  #eqSection {
    flex: 1;
    background: #222;
    border-radius: 12px;
    padding: 15px;
    max-height: 600px;
    overflow-y: auto;
  }
  #eqSection h2 {
    text-align: center;
    margin-bottom: 10px;
  }
  .eq-skin {
    background: #333;
    border-radius: 8px;
    margin: 8px 0;
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: default;
    user-select: none;
    position: relative;
  }
  .eq-skin img {
    width: 80px;
    height: 40px;
    object-fit: contain;
    border-radius: 6px;
    filter: drop-shadow(0 0 5px #000);
  }
  .eq-skin.sellable {
    border: 2px solid #ff4500;
    cursor: pointer;
  }
  .eq-skin .sell-mark {
    position: absolute;
    top: 4px;
    right: 8px;
    color: #ff4500;
    font-weight: 900;
    font-size: 20px;
    pointer-events: none;
  }
  #sellToggleBtn {
    background: #aa3300;
    margin: 15px 0 10px 0;
    width: 100%;
  }
  #openCaseBtn {
    margin-top: 15px;
    width: 180px;
  }
</style>
</head>
<body>

<header>
  <input type="number" id="depositInput" placeholder="Wpłać kasę" min="0" />
  <button id="depositBtn">WPŁAĆ</button>
</header>

<div id="balance">Kasa: $1000</div>

<main>
  <section id="casesList">
    <h2>Wybierz Skrzynkę</h2>
    <!-- Skrzynki będą tutaj -->
  </section>

  <section id="rouletteSection">
    <div id="rouletteDisplay">
      <div id="rouletteInner"></div>
    </div>
    <div id="rouletteButtons">
      <button id="openCaseBtn" disabled>Otwórz Skrzynkę</button>
      <button id="sellToggleBtn">Sprzedaj</button>
    </div>
    <div id="resultSection">
      <div id="resultSkinName"></div>
      <img id="resultSkinImg" src="" alt="" />
      <div id="resultButtons" style="margin-top:10px; display:none;">
        <button id="moveToEqBtn">Przenieś do EQ</button>
        <button id="sellNowBtn">Sprzedaj Teraz</button>
      </div>
    </div>
  </section>

  <section id="eqSection">
    <h2>Ekwipunek</h2>
    <div id="eqList">
      <!-- Skiny z eq tutaj -->
    </div>
  </section>
</main>

<script>
// SKINY Z WARTOŚCIAMI (wartość w $)
const skinsData = {
  "AWP | Dragon Lore": 2500,
  "M4A1-S | Printstream": 1800,
  "AK-47 | The Empress": 2200,
  "Butterfly Knife | Doppler": 3000,
  "USP-S | Kill Confirmed": 1600,
  "AK-47 | Fire Serpent": 2100,
  "M4A4 | Howl": 2700,
  "Desert Eagle | Blaze": 1500,
  "Glock-18 | Water Elemental": 900,
  "Karambit | Fade": 2800,
  "AWP | Asiimov": 1900,
  "AK-47 | Neon Rider": 1700,
  "USP-S | Cortex": 1400,
  "M4A4 | Poseidon": 1600,
  "AK-47 | Redline": 1300,
  "USP-S | Printstream": 1200,
  "AWP | Fever Dream": 2000,
  "AK-47 | Bloodsport": 1100,
  "Desert Eagle | Printstream": 1000,
  "M4A1-S | Decimator": 900,
  "AWP | Neo-Noir": 1600,
  "AK-47 | Phantom Disruptor": 1400,
  "Glock-18 | Fade": 850,
  "Karambit | Doppler": 2700,
  "AK-47 | Legion of Anubis": 1200,
  "USP-S | The Traitor": 1100,
  "AWP | Chromatic Aberration": 2300,
  "AK-47 | Nightwish": 1250,
  "P250 | Visions": 700,
  "Butterfly Knife | Fade": 2600,
  "Desert Eagle | Mecha Industries": 1500,
  "M4A4 | Neo-Noir": 1600,
  "USP-S | Monster Mashup": 1100,
  "AK-47 | Elite Build": 900,
  "AWP | Duality": 1300,
  "Desert Eagle | Ocean Drive": 1000,
  "Glock-18 | Vogue": 800,
  "Talon Knife | Slaughter": 2900,
  "AK-47 | Vulcan": 1250,
  "AWP | Wildfire": 2200,
  "USP-S | Ticket to Hell": 1100,
  "Butterfly Knife | Lore": 3200,
  "M4A1-S | Hyper Beast": 1400,
  "Glock-18 | Wasteland Rebel": 750,
  "Karambit | Tiger Tooth": 2600,
  "AK-47 | Ice Coaled": 1200,
  "AWP | Blackiimov (Blacki Edition)": 2000,
  "M4A4 | The Emperor": 1700,
  "USP-S | Whiteout": 1300,
  "Desert Eagle | Code Red": 1400,
};

// FOLDER Z OBRAZKAMI - nazwy plików to nazwy skinów małymi literami, spacje i znak | na _ i inne znaki na nic
function skinNameToFile(name) {
  return name
    .toLowerCase()
    .replace(/ \| /g, "_")
    .replace(/ /g, "_")
    .replace(/[^\w_]/g, "")
    + ".jpg";
}

// 10 SKRZYNEK - każda z własnymi skinami i szansami
const cases = [
  {
    name: "Premium Case",
    price: 1000,
    skins: [
      { name: "Butterfly Knife | Lore", chance: 0.01 },
      { name: "Butterfly Knife | Doppler", chance: 0.02 },
      { name: "Karambit | Fade", chance: 0.03 },
      { name: "AWP | Dragon Lore", chance: 0.05 },
      { name: "M4A4 | Howl", chance: 0.05 },
      { name: "AWP | Chromatic Aberration", chance: 0.07 },
      { name: "AK-47 | The Empress", chance: 0.1 },
      { name: "USP-S | Kill Confirmed", chance: 0.12 },
      { name: "Desert Eagle | Blaze", chance: 0.15 },
      { name: "Glock-18 | Water Elemental", chance: 0.4 },
    ],
  },
  {
    name: "Knife Case",
    price: 800,
    skins: [
      { name: "Butterfly Knife | Fade", chance: 0.05 },
      { name: "Karambit | Tiger Tooth", chance: 0.07 },
      { name: "Talon Knife | Slaughter", chance: 0.03 },
      { name: "Butterfly Knife | Doppler", chance: 0.1 },
      { name: "Karambit | Doppler", chance: 0.15 },
      { name: "Butterfly Knife | Lore", chance: 0.2 },
      { name: "Karambit | Fade", chance: 0.25 },
      { name: "Talon Knife | Slaughter", chance: 0.15 },
      { name: "Butterfly Knife | Fade", chance: 0.2 },
      { name: "Karambit | Tiger Tooth", chance: 0.25 },
    ],
  },
  {
    name: "AWP Case",
    price: 600,
    skins: [
      { name: "AWP | Dragon Lore", chance: 0.05 },
      { name: "AWP | Asiimov", chance: 0.1 },
      { name: "AWP | Fever Dream", chance: 0.1 },
      { name: "AWP | Neo-Noir", chance: 0.15 },
      { name: "AWP | Chromatic Aberration", chance: 0.15 },
      { name: "AWP | Duality", chance: 0.2 },
      { name: "AWP | Wildfire", chance: 0.25 },
      { name: "AWP | Blackiimov (Blacki Edition)", chance: 0.3 },
    ],
  },
  {
    name: "AK-47 Case",
    price: 700,
    skins: [
      { name: "AK-47 | The Empress", chance: 0.05 },
      { name: "AK-47 | Fire Serpent", chance: 0.07 },
      { name: "AK-47 | Redline", chance: 0.1 },
      { name: "AK-47 | Bloodsport", chance: 0.12 },
      { name: "AK-47 | Neon Rider", chance: 0.15 },
      { name: "AK-47 | Legion of Anubis", chance: 0.15 },
      { name: "AK-47 | Nightwish", chance: 0.18 },
      { name: "AK-47 | Phantom Disruptor", chance: 0.2 },
      { name: "AK-47 | Vulcan", chance: 0.22 },
      { name: "AK-47 | Elite Build", chance: 0.25 },
    ],
  },
  {
    name: "USP-S Case",
    price: 550,
    skins: [
      { name: "USP-S | Kill Confirmed", chance: 0.07 },
      { name: "USP-S | Printstream", chance: 0.1 },
      { name: "USP-S | Cortex", chance: 0.12 },
      { name: "USP-S | The Traitor", chance: 0.15 },
      { name: "USP-S | Monster Mashup", chance: 0.2 },
      { name: "USP-S | Ticket to Hell", chance: 0.22 },
      { name: "USP-S | Whiteout", chance: 0.25 },
      { name: "USP-S | Kill Confirmed", chance: 0.3 },
    ],
  },
  {
    name: "M4 Case",
    price: 650,
    skins: [
      { name: "M4A1-S | Printstream", chance: 0.1 },
      { name: "M4A1-S | Decimator", chance: 0.12 },
      { name: "M4A1-S | Hyper Beast", chance: 0.15 },
      { name: "M4A4 | Howl", chance: 0.15 },
      { name: "M4A4 | Neo-Noir", chance: 0.2 },
      { name: "M4A4 | Poseidon", chance: 0.22 },
      { name: "M4A4 | The Emperor", chance: 0.25 },
      { name: "M4A4 | Howl", chance: 0.3 },
    ],
  },
  {
    name: "Desert Eagle Case",
    price: 500,
    skins: [
      { name: "Desert Eagle | Blaze", chance: 0.15 },
      { name: "Desert Eagle | Printstream", chance: 0.18 },
      { name: "Desert Eagle | Mecha Industries", chance: 0.2 },
      { name: "Desert Eagle | Ocean Drive", chance: 0.22 },
      { name: "Desert Eagle | Code Red", chance: 0.25 },
      { name: "Desert Eagle | Blaze", chance: 0.3 },
    ],
  },
  {
    name: "Glock Case",
    price: 400,
    skins: [
      { name: "Glock-18 | Water Elemental", chance: 0.15 },
      { name: "Glock-18 | Fade", chance: 0.18 },
      { name: "Glock-18 | Vogue", chance: 0.2 },
      { name: "Glock-18 | Wasteland Rebel", chance: 0.22 },
      { name: "Glock-18 | Fade", chance: 0.25 },
      { name: "Glock-18 | Vogue", chance: 0.3 },
    ],
  },
  {
    name: "Rare Knives Case",
    price: 1200,
    skins: [
      { name: "Karambit | Fade", chance: 0.05 },
      { name: "Karambit | Doppler", chance: 0.07 },
      { name: "Butterfly Knife | Fade", chance: 0.1 },
      { name: "Talon Knife | Slaughter", chance: 0.15 },
      { name: "Karambit | Tiger Tooth", chance: 0.17 },
      { name: "Butterfly Knife | Lore", chance: 0.2 },
      { name: "Karambit | Fade", chance: 0.22 },
      { name: "Talon Knife | Slaughter", chance: 0.3 },
    ],
  },
];

// Balans kasy
let balance = 1000;

// Wybrana skrzynka
let selectedCaseIndex = null;

// Tryb sprzedawania
let sellMode = false;

// Ekwipunek (tablica skinów)
const inventory = [];

// Elementy DOM
const balanceEl = document.getElementById("balance");
const depositInput = document.getElementById("depositInput");
const depositBtn = document.getElementById("depositBtn");
const casesListEl = document.getElementById("casesList");
const openCaseBtn = document.getElementById("openCaseBtn");
const sellToggleBtn = document.getElementById("sellToggleBtn");
const rouletteInner = document.getElementById("rouletteInner");
const resultSkinName = document.getElementById("resultSkinName");
const resultSkinImg = document.getElementById("resultSkinImg");
const resultButtons = document.getElementById("resultButtons");
const moveToEqBtn = document.getElementById("moveToEqBtn");
const sellNowBtn = document.getElementById("sellNowBtn");
const eqList = document.getElementById("eqList");

// Aktualizuj balans
function updateBalance() {
  balanceEl.textContent = `Kasa: $${balance.toFixed(2)}`;
}

// Dodaj kase do listy
function renderCases() {
  casesListEl.innerHTML = "<h2>Wybierz Skrzynkę</h2>";
  cases.forEach((c, i) => {
    const div = document.createElement("div");
    div.classList.add("case-item");
    if (i === selectedCaseIndex) div.classList.add("selected");
    div.textContent = `${c.name} - $${c.price}`;
    div.onclick = () => {
      selectedCaseIndex = i;
      openCaseBtn.disabled = false;
      renderCases();
    };
    casesListEl.appendChild(div);
  });
}

// Zwróć wylosowanego skina na podstawie szans i losowania
function pickSkin(caseObj) {
  // Normalizacja szans (suma musi być 1)
  let totalChance = caseObj.skins.reduce((acc, s) => acc + s.chance, 0);
  // Normalizujemy jeśli suma nie równa się 1
  let rnd = Math.random() * totalChance;
  for (let s of caseObj.skins) {
    if (rnd < s.chance) return s;
    rnd -= s.chance;
  }
  return caseObj.skins[caseObj.skins.length - 1];
}

// Pokazuj animacje ruletki kilka sekund
function startRoulette(caseObj) {
  openCaseBtn.disabled = true;
  depositBtn.disabled = true;
  depositInput.disabled = true;
  sellToggleBtn.disabled = true;

  const skinsToShow = [];
  // Wylosuj 30 skinów do animacji ruletki (losujemy z case)
  for (let i = 0; i < 30; i++) {
    skinsToShow.push(pickSkin(caseObj));
  }
  // Powiększamy tablicę by nie było zbyt szybkie powtórzenia
  let skinsSequence = [];
  for (let i = 0; i < 3; i++) {
    skinsSequence = skinsSequence.concat(skinsToShow);
  }

  // Wyczyść i dodaj karty do ruletki
  rouletteInner.innerHTML = "";
  skinsSequence.forEach(skin => {
    const card = document.createElement("div");
    card.className = "skin-card";
    card.innerHTML = `
      <img src="https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/${encodeURIComponent(skin.name)}.png" alt="${skin.name}" onerror="this.src='https://via.placeholder.com/120x60?text=No+Img'"/>
      <div>${skin.name}</div>
      <div>$${skinsData[skin.name] || 0}</div>
    `;
    rouletteInner.appendChild(card);
  });

  let pos = 0;
  let speed = 15;
  let deceleration = 0.1;

  return new Promise(resolve => {
    function animate() {
      pos += speed;
      if (speed > 0) speed -= deceleration;
      if (speed < 0) speed = 0;
      rouletteInner.style.transform = `translateX(${-pos}px)`;
      if (speed > 0) {
        requestAnimationFrame(animate);
      } else {
        // Znajdź skin który jest na środku ekranu (obliczenia)
        // Szerokość karty + margin = 150 + 20 = 170px
        const cardWidth = 170;
        let index = Math.round(pos / cardWidth);
        if(index >= skinsSequence.length) index = skinsSequence.length -1;
        const chosenSkin = skinsSequence[index];
        resolve(chosenSkin);
      }
    }
    animate();
  }).finally(() => {
    openCaseBtn.disabled = false;
    depositBtn.disabled = false;
    depositInput.disabled = false;
    sellToggleBtn.disabled = false;
  });
}

let lastResultSkin = null;

openCaseBtn.onclick = async () => {
  if (selectedCaseIndex === null) return alert("Wybierz skrzynkę");
  const caseObj = cases[selectedCaseIndex];
  if (balance < caseObj.price) return alert("Nie masz kasy na tę skrzynkę!");

  balance -= caseObj.price;
  updateBalance();

  resultSkinName.textContent = "Losowanie...";
  resultSkinImg.src = "";
  resultButtons.style.display = "none";

  const skin = await startRoulette(caseObj);

  lastResultSkin = skin;
  resultSkinName.textContent = skin.name;
  resultSkinImg.src = `https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/${encodeURIComponent(skin.name)}.png`;
  resultButtons.style.display = "flex";
};

depositBtn.onclick = () => {
  const val = Number(depositInput.value);
  if (val > 0) {
    balance += val;
    updateBalance();
    depositInput.value = "";
  }
};

moveToEqBtn.onclick = () => {
  if (!lastResultSkin) return;
  inventory.push(lastResultSkin);
  alert(`Skin ${lastResultSkin.name} dodany do ekwipunku`);
  lastResultSkin = null;
  resultSkinName.textContent = "";
  resultSkinImg.src = "";
  resultButtons.style.display = "none";
  renderInventory();
};

sellNowBtn.onclick = () => {
  if (!lastResultSkin) return;
  const price = skinsData[lastResultSkin.name] || 0;
  balance += price;
  alert(`Sprzedano ${lastResultSkin.name} za $${price}`);
  lastResultSkin = null;
  resultSkinName.textContent = "";
  resultSkinImg.src = "";
  resultButtons.style.display = "none";
  updateBalance();
};

sellToggleBtn.onclick = () => {
  sellMode = !sellMode;
  sellToggleBtn.textContent = sellMode ? "Wyłącz sprzedaż" : "Sprzedaj";
  renderInventory();
};

function renderInventory() {
  eqList.innerHTML = "";
  inventory.forEach((skin, i) => {
    const div = document.createElement("div");
    div.classList.add("eq-skin");
    if (sellMode) div.classList.add("sellable");
    div.innerHTML = `
      <img src="https://cdn.cloudflare.steamstatic.com/apps/730/icons/econ/default_generated/${encodeURIComponent(skin.name)}.png" alt="${skin.name}" />
      <div>${skin.name}</div>
      <div>$${skinsData[skin.name] || 0}</div>
      <div class="sell-mark" style="display:none;">🛒</div>
    `;

    let isMarkedForSell = false;

    if (sellMode) {
      div.querySelector(".sell-mark").style.display = "none";
      div.onclick = () => {
        isMarkedForSell = !isMarkedForSell;
        if (isMarkedForSell) {
          div.querySelector(".sell-mark").style.display = "block";
        } else {
          div.querySelector(".sell-mark").style.display = "none";
        }
      };
    } else {
      div.onclick = null;
    }

    eqList.appendChild(div);
  });
}

updateBalance();
renderCases();
renderInventory();

</script>

</body>
</html>
